import{d as H,a as c,t as D,p as V,q as L,o as l,c as h,r as U,s as J,v as a,b as u,w as M,x,g as S,y as q,z as K,A as f,B as A,n as k,F as I,C as $,D as W,E as j,G as X,H as Y,_ as B}from"./index-p7gQ7ES5.js";import{S as Z,D as ee}from"./ScheduleListItem-DTKicMBV.js";import{S as te,F as se}from"./SearchBar-CRTpb1je.js";import{N as ae}from"./NoEntries-Kesku3fp.js";import{u as N}from"./useEventData-DsC2PgfC.js";import"./TagLabel-D_5T2nn4.js";const F=H({__name:"SwitchView",props:{targetView:{}},setup(w){const v=w,d=V(),y=L(),g=()=>{d.replace({query:{...y.query,view:v.targetView}})};return(p,r)=>(l(),c("button",{onClick:g},D(p.$t("change-view")),1))}}),re={class:"full-height"},ne={class:"btn-header"},oe=H({__name:"ScheduleList",setup(w){const{performances:v}=N(),d=L(),y=h(()=>d.query.search??"false"),g=h(()=>d.query.fav==="true"),p=U(!1),r=J({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),m=e=>{a.value.searchQuery=e,a.value.stages=[],a.value.stageTypes=[],a.value.categories=[],a.value.actTypes=[],a.value.perforTypes=[],a.value.performanceTags=[],a.value.actIDs=[],a.value.performanceIDs=[]},o=e=>{a.value.stages=e.stages||[],a.value.stageTypes=e.stageTypes||[],a.value.categories=e.categories||[],a.value.actTypes=e.actTypes||[],a.value.perforTypes=e.perforTypes||[],a.value.performanceTags=e.performanceTags||[],a.value.searchQuery=e.searchQuery||"",a.value.actIDs=e.actIDs||[],a.value.performanceIDs=e.performanceIDs||[],r.stages=[...a.value.stages],r.stageTypes=[...a.value.stageTypes],r.categories=[...a.value.categories],r.actTypes=[...a.value.actTypes],r.perforTypes=[...a.value.perforTypes],r.performanceTags=[...a.value.performanceTags],r.searchQuery=a.value.searchQuery},b=h(()=>g.value?{...a.value,performanceIDs:_.value.map(e=>String(e.id))}:a.value),_=h(()=>{const e=JSON.parse(localStorage.getItem("event")||"[]");return!v.value||v.value.length===0?(console.warn("Performances data not available yet!"),[]):v.value.filter(t=>e.includes(t.id.toString()))}),E=h(()=>_.value.length>0),C=h(()=>{if(!v.value)return!1;let e=v.value;if(g.value){const t=_.value.map(n=>n.id.toString());e=e.filter(n=>t.includes(n.id.toString()))}return e.length>0});return(e,t)=>(l(),c("div",re,[u("div",null,[x(S(te,{onApply:m},null,512),[[q,y.value==="true"]])]),u("div",ne,[p.value?(l(),M(se,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":r.stages,"initial-stage-types":r.stageTypes,"initial-categories":r.categories,"initial-act-types":r.actTypes,"initial-perfor-types":r.perforTypes,"initial-performance-tags":r.performanceTags,"initial-search-query":r.searchQuery,onApply:o,onClose:t[0]||(t[0]=n=>p.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):K("",!0),S(F,{targetView:"table",class:"btn left"}),u("button",{onClick:t[1]||(t[1]=n=>p.value=!0),class:"btn right"},D(e.$t("open-filter")),1)]),C.value?(l(),M(Z,{key:0,filters:b.value,class:"ProgrammList"},null,8,["filters"])):(l(),M(ae,{key:1,type:g.value&&!E.value?"favorites":"event"},null,8,["type"]))]))}}),le={class:"table-content"},ie={class:"timeline"},ce={class:"timeline-column"},ue={class:"timeline-header"},ve={class:"stages"},pe={class:"timeline-header"},de={key:0},ge={key:1},me={key:2},he=H({__name:"ScheduleTableItem",props:{date:String},setup(w){const v=w,{performances:d,acts:y,stages:g}=N(),p=e=>j(e,y),r=h(()=>d.value.filter(e=>{const t=f(e.start_time),n=f(v.date),i=t.getHours()<A&&t.getDate()===n.getDate()+1,T=t.getDate()===n.getDate()||i;return t.getHours()<A&&t.getDate()===n.getDate()?!1:T}).sort((e,t)=>{const n=f(e.start_time)??new Date(0),i=f(t.start_time)??new Date(0);return n.getTime()-i.getTime()})),m=h(()=>g.value.filter(e=>r.value.some(t=>t.stageID===e.id))),o=h(()=>{const t=r.value.flatMap(s=>[f(s.start_time).getHours(),f(s.end_time).getHours()]).map(s=>s<A?s+24:s),n=Math.min(...t)-1,i=Math.max(...t)+1;return Array.from({length:i-n+1},(s,T)=>(n+T)%24)}),b=e=>{const t=f(e.start_time),n=f(e.end_time),i=o.value[0],s=o.value.length*60,T=(t.getHours()<i?t.getHours()+24:t.getHours())*60+t.getMinutes()-i*60,P=(n.getHours()<i?n.getHours()+24:n.getHours())*60+n.getMinutes()-i*60,Q=T/s*100,z=(P-T)/s*100,O=1,R=o.value.length*60,G=O/R*100;return{top:`${Q}%`,height:`calc(${z}% - ${G}%)`}},_=()=>{const e=o.value[0];return{height:`${((o.value[o.value.length-1]<e?o.value[o.value.length-1]+24:o.value[o.value.length-1])-e+1)*60}px`}},E=e=>{const t=o.value[0],n=o.value.length*60;return{top:((e<t?e+24:e)*60-t*60)/n*100+"%"}},C=e=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(e)?e:"default";return(e,t)=>{const n=Y("router-link");return l(),c("div",le,[u("div",ie,[u("div",ce,[u("div",ue,D(e.$t("Time")),1),u("div",{class:"time-slots",style:k(_())},[(l(!0),c(I,null,$(o.value,i=>(l(),c("div",{key:i,class:"time-slot",style:k(E(i))},D(i%24)+":00 ",5))),128))],4)])]),u("div",ve,[(l(!0),c(I,null,$(m.value,i=>(l(),c("div",{key:i.id,class:"stage"},[u("div",pe,D(i.name),1),u("div",{class:"events",style:k(_())},[(l(!0),c(I,null,$(o.value,s=>(l(),c("div",{key:s,class:"time-slot",style:k(E(s))},null,4))),128)),(l(!0),c(I,null,$(r.value.filter(s=>s.stageID===i.id),s=>{var T;return l(),M(n,{key:s.id,to:"/event/"+(((T=s["id-name"])==null?void 0:T.trim())||s.id),class:X(["event",C(s==null?void 0:s.type)]),style:k(b(s)),title:s.name||p(s.actsIDArr)||e.$t("Unknown")},{default:W(()=>[u("strong",null,[s.name?(l(),c("div",de,D(s.name),1)):s.actsIDArr.length?(l(),c("div",ge,D(p(s.actsIDArr)),1)):(l(),c("div",me,D(e.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),fe=B(he,[["__scopeId","data-v-b85be1ad"]]),ye={class:"schedule-table scroll-head full-height"},_e={class:"btn-header"},Te={class:"timetable scroll-y-area"},De=H({__name:"ScheduleTable",setup(w){const v=V();function d(p){v.replace({hash:`#${p}`,query:{...v.currentRoute.value.query}});const r=document.getElementById(p);r&&r.scrollIntoView({behavior:"smooth"})}const{performances:y}=N(),g=h(()=>{const p=new Set(y.value.map(m=>f(m.start_time).toLocaleDateString("en-CA"))),r=new Set;return y.value.forEach(m=>{const o=f(m.start_time),b=o.getHours();if(b>=0&&b<A){const _=new Date(o);_.setDate(o.getDate()-1),r.add(_.toLocaleDateString("en-CA"))}}),Array.from(new Set([...p,...r])).sort()});return(p,r)=>(l(),c("div",ye,[u("div",_e,[S(F,{targetView:"list",class:"btn full"})]),u("div",Te,[(l(!0),c(I,null,$(g.value,(m,o)=>(l(),c("div",{key:m,class:"day-table"},[S(ee,{date:m,index:o,sortedDateList:g.value,scrollToDate:d},null,8,["date","index","sortedDateList"]),S(fe,{date:m},null,8,["date"])]))),128))])]))}}),Se=B(De,[["__scopeId","data-v-cb8df120"]]),we={class:"full-height"},be={class:"full-height"},Ae=H({__name:"ScheduleView",setup(w){const v=L();V();const d=h(()=>v.query.view??"list");return(y,g)=>(l(),c("div",null,[x(u("div",we,[S(oe,{class:"full-height"})],512),[[q,d.value==="list"]]),x(u("div",be,[S(Se,{class:"full-height"})],512),[[q,d.value==="table"]])]))}});export{Ae as default};
