import{d as M,a as l,t as T,p as V,q as L,o,c as D,r as U,s as J,v as s,b as v,g as k,w as E,x as q,y as B,z as K,A as _,B as A,n as I,F as H,C,D as W,E as j,G as X,H as Y,_ as P,u as Z,f as ee}from"./index-CPXJwdLf.js";import{S as te}from"./ScheduleListItem-BOriPG4R.js";import{S as se,F as ae}from"./SearchBar-DSWaZ_K7.js";import{u as x}from"./useEventData-CGAfq2kc.js";import"./TagLabel-B8pI4c43.js";const F=M({__name:"SwitchView",props:{targetView:{}},setup(b){const d=b,g=V(),f=L(),h=()=>{g.replace({query:{...f.query,view:d.targetView}})};return(p,a)=>(o(),l("button",{onClick:h},T(p.$t("change-view")),1))}}),re={class:"full-height"},ne={class:"btn-header"},oe=M({__name:"ScheduleList",setup(b){const{performances:d}=x(),g=L(),f=D(()=>g.query.search??"false"),h=D(()=>g.query.fav==="true"),p=U(!1),a=J({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),m=i=>{s.value.searchQuery=i,s.value.stages=[],s.value.stageTypes=[],s.value.categories=[],s.value.actTypes=[],s.value.perforTypes=[],s.value.performanceTags=[],s.value.actIDs=[],s.value.performanceIDs=[]},r=i=>{s.value.stages=i.stages||[],s.value.stageTypes=i.stageTypes||[],s.value.categories=i.categories||[],s.value.actTypes=i.actTypes||[],s.value.perforTypes=i.perforTypes||[],s.value.performanceTags=i.performanceTags||[],s.value.searchQuery=i.searchQuery||"",s.value.actIDs=i.actIDs||[],s.value.performanceIDs=i.performanceIDs||[],a.stages=[...s.value.stages],a.stageTypes=[...s.value.stageTypes],a.categories=[...s.value.categories],a.actTypes=[...s.value.actTypes],a.perforTypes=[...s.value.perforTypes],a.performanceTags=[...s.value.performanceTags],a.searchQuery=s.value.searchQuery},S=D(()=>h.value?{...s.value,performanceIDs:$.value.map(i=>String(i.id))}:s.value),$=D(()=>{const i=JSON.parse(localStorage.getItem("event")||"[]");return!d.value||d.value.length===0?(console.warn("Performances data not available yet!"),[]):d.value.filter(w=>i.includes(w.id.toString()))});return(i,w)=>(o(),l("div",re,[v("div",null,[E(k(se,{onApply:m},null,512),[[q,f.value==="true"]])]),v("div",ne,[p.value?(o(),B(ae,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":a.stages,"initial-stage-types":a.stageTypes,"initial-categories":a.categories,"initial-act-types":a.actTypes,"initial-perfor-types":a.perforTypes,"initial-performance-tags":a.performanceTags,"initial-search-query":a.searchQuery,onApply:r,onClose:w[0]||(w[0]=t=>p.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):K("",!0),k(F,{targetView:"table",class:"btn left"}),v("button",{onClick:w[1]||(w[1]=t=>p.value=!0),class:"btn right"},T(i.$t("open-filter")),1)]),k(te,{filters:S.value,class:"ProgrammList"},null,8,["filters"])]))}}),le={class:"table-content"},ie={class:"timeline"},ce={class:"timeline-column"},ue={class:"timeline-header"},ve={class:"stages"},pe={class:"timeline-header"},de={key:0},ge={key:1},me={key:2},he=M({__name:"ScheduleTableItem",props:{date:String},setup(b){const d=b,{performances:g,acts:f,stages:h}=x(),p=t=>X(t,f),a=D(()=>g.value.filter(t=>{const n=_(t.start_time),u=_(d.date),c=n.getHours()<A&&n.getDate()===u.getDate()+1,y=n.getDate()===u.getDate()||c;return n.getHours()<A&&n.getDate()===u.getDate()?!1:y}).sort((t,n)=>{const u=_(t.start_time)??new Date(0),c=_(n.start_time)??new Date(0);return u.getTime()-c.getTime()})),m=D(()=>h.value.filter(t=>a.value.some(n=>n.stageID===t.id))),r=D(()=>{const n=a.value.flatMap(e=>[_(e.start_time).getHours(),_(e.end_time).getHours()]).map(e=>e<A?e+24:e),u=Math.min(...n)-1,c=Math.max(...n)+1;return Array.from({length:c-u+1},(e,y)=>(u+y)%24)}),S=t=>{const n=_(t.start_time),u=_(t.end_time),c=r.value[0],e=r.value.length*60,y=(n.getHours()<c?n.getHours()+24:n.getHours())*60+n.getMinutes()-c*60,N=(u.getHours()<c?u.getHours()+24:u.getHours())*60+u.getMinutes()-c*60,Q=y/e*100,z=(N-y)/e*100,O=1,R=r.value.length*60,G=O/R*100;return{top:`${Q}%`,height:`calc(${z}% - ${G}%)`}},$=()=>{const t=r.value[0];return{height:`${((r.value[r.value.length-1]<t?r.value[r.value.length-1]+24:r.value[r.value.length-1])-t+1)*60}px`}},i=t=>{const n=r.value[0],u=r.value.length*60;return{top:((t<n?t+24:t)*60-n*60)/u*100+"%"}},w=t=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(t)?t:"default";return(t,n)=>{const u=Y("router-link");return o(),l("div",le,[v("div",ie,[v("div",ce,[v("div",ue,T(t.$t("Time")),1),v("div",{class:"time-slots",style:I($())},[(o(!0),l(H,null,C(r.value,c=>(o(),l("div",{key:c,class:"time-slot",style:I(i(c))},T(c%24)+":00 ",5))),128))],4)])]),v("div",ve,[(o(!0),l(H,null,C(m.value,c=>(o(),l("div",{key:c.id,class:"stage"},[v("div",pe,T(c.name),1),v("div",{class:"events",style:I($())},[(o(!0),l(H,null,C(r.value,e=>(o(),l("div",{key:e,class:"time-slot",style:I(i(e))},null,4))),128)),(o(!0),l(H,null,C(a.value.filter(e=>e.stageID===c.id),e=>{var y;return o(),B(u,{key:e.id,to:"/event/"+(((y=e["id-name"])==null?void 0:y.trim())||e.id),class:j(["event",w(e==null?void 0:e.type)]),style:I(S(e)),title:e.name||p(e.actsIDArr)||t.$t("Unknown")},{default:W(()=>[v("strong",null,[e.name?(o(),l("div",de,T(e.name),1)):e.actsIDArr.length?(o(),l("div",ge,T(p(e.actsIDArr)),1)):(o(),l("div",me,T(t.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),_e=P(he,[["__scopeId","data-v-b85be1ad"]]),fe={class:"schedule-table"},ye={class:"btn-header"},Te={class:"timetable scroll-area"},De={class:"group-head"},Se={class:"date-nav-container"},we=["onClick"],$e={key:1,class:"nav-arrow nav-left"},ke=["id"],be=["onClick"],Ie={key:3,class:"nav-arrow nav-right"},He=M({__name:"ScheduleTable",setup(b){const d=V();function g(p){d.replace({hash:`#${p}`,query:{...d.currentRoute.value.query}});const a=document.getElementById(p);a&&a.scrollIntoView({behavior:"smooth"})}const{performances:f}=x(),h=D(()=>{const p=new Set(f.value.map(m=>_(m.start_time).toLocaleDateString("en-CA"))),a=new Set;return f.value.forEach(m=>{const r=_(m.start_time),S=r.getHours();if(S>=0&&S<A){const $=new Date(r);$.setDate(r.getDate()-1),a.add($.toLocaleDateString("en-CA"))}}),Array.from(new Set([...p,...a])).sort()});return(p,a)=>(o(),l("div",fe,[v("div",ye,[k(F,{targetView:"list",class:"btn full"})]),v("div",Te,[(o(!0),l(H,null,C(h.value,(m,r)=>(o(),l("div",{key:m,class:"day-table"},[v("div",De,[v("div",Se,[r>0?(o(),l("button",{key:0,class:"nav-arrow nav-left",onClick:S=>g(h.value[r-1])}," < ",8,we)):(o(),l("div",$e)),v("h2",{class:"head-date",id:m},T(Z(ee)(m,"Date Long")),9,ke),r<h.value.length-1?(o(),l("button",{key:2,class:"nav-arrow nav-right",onClick:S=>g(h.value[r+1])}," > ",8,be)):(o(),l("div",Ie))])]),k(_e,{date:m},null,8,["date"])]))),128))])]))}}),Ce=P(He,[["__scopeId","data-v-e956e389"]]),Me={class:"full-height"},Ae={class:"full-height"},Be=M({__name:"ScheduleView",setup(b){const d=L();V();const g=D(()=>d.query.view??"list");return(f,h)=>(o(),l("div",null,[E(v("div",Me,[k(oe,{class:"full-height"})],512),[[q,g.value==="list"]]),E(v("div",Ae,[k(Ce,{class:"full-height"})],512),[[q,g.value==="table"]])]))}});export{Be as default};
