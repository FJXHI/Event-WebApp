import{d as A,a as c,t as S,p as Y,q as O,o as i,c as _,r as C,s as Z,v as r,b as g,w as V,x as q,g as k,y as P,z as ee,A as te,B as se,C as b,n as M,F as E,D as x,E as J,G as ae,H as ne,J as re,_ as le,K as oe,u as ie,L as ue}from"./index-DJxE-Fqm.js";import{S as ce,F as ge,D as ve}from"./ScheduleListItem-HwKtQ9dd.js";import{S as pe,F as de}from"./SearchBar-DwklHNYp.js";import{N as me}from"./NoEntries-BQaiz-g7.js";import{u as Q}from"./useEventData-CLccO9Wt.js";import"./TagLabel-ClzWwkXI.js";const K=A({__name:"SwitchView",props:{targetView:{}},setup(F){const u=F,v=Y(),p=O(),d=()=>{v.replace({query:{...p.query,view:u.targetView}})};return(f,l)=>(i(),c("button",{onClick:d},S(f.$t("change-view")),1))}}),he={class:"full-height"},ye={class:"btn-header"},fe=A({__name:"ScheduleList",setup(F){const{performances:u}=Q(),v=O(),p=_(()=>v.query.search??"false"),d=_(()=>v.query.fav==="true"),f=C(!1),l=Z({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),$=e=>{r.value.searchQuery=e,r.value.stages=[],r.value.stageTypes=[],r.value.categories=[],r.value.actTypes=[],r.value.perforTypes=[],r.value.performanceTags=[],r.value.actIDs=[],r.value.performanceIDs=[]},I=e=>{r.value.stages=e.stages||[],r.value.stageTypes=e.stageTypes||[],r.value.categories=e.categories||[],r.value.actTypes=e.actTypes||[],r.value.perforTypes=e.perforTypes||[],r.value.performanceTags=e.performanceTags||[],r.value.searchQuery=e.searchQuery||"",r.value.actIDs=e.actIDs||[],r.value.performanceIDs=e.performanceIDs||[],l.stages=[...r.value.stages],l.stageTypes=[...r.value.stageTypes],l.categories=[...r.value.categories],l.actTypes=[...r.value.actTypes],l.perforTypes=[...r.value.perforTypes],l.performanceTags=[...r.value.performanceTags],l.searchQuery=r.value.searchQuery},h=_(()=>d.value?{...r.value,performanceIDs:D.value.map(e=>String(e.id))}:r.value),D=_(()=>{const e=JSON.parse(localStorage.getItem("event")||"[]");return!u.value||u.value.length===0?(console.warn("Performances data not available yet!"),[]):u.value.filter(y=>e.includes(y.id.toString()))}),m=_(()=>D.value.length>0),w=_(()=>{if(!u.value)return!1;let e=u.value;if(d.value){const y=D.value.map(H=>H.id.toString());e=e.filter(H=>y.includes(H.id.toString()))}return e.length>0});return(e,y)=>(i(),c("div",he,[g("div",null,[q(k(pe,{onApply:$},null,512),[[P,p.value==="true"]])]),g("div",ye,[f.value?(i(),V(de,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":l.stages,"initial-stage-types":l.stageTypes,"initial-categories":l.categories,"initial-act-types":l.actTypes,"initial-perfor-types":l.perforTypes,"initial-performance-tags":l.performanceTags,"initial-search-query":l.searchQuery,onApply:I,onClose:y[0]||(y[0]=H=>f.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):ee("",!0),k(K,{targetView:"table",class:"btn left"}),g("button",{onClick:y[1]||(y[1]=H=>f.value=!0),class:"btn right"},S(e.$t("open-filter")),1)]),w.value?(i(),V(ce,{key:0,filters:h.value,class:"ProgrammList"},null,8,["filters"])):(i(),V(me,{key:1,type:d.value&&!m.value?"favorites":"event"},null,8,["type"]))]))}}),_e=A({__name:"SwitchViewType",props:{stageTypeFilter:{}},emits:["toggle"],setup(F,{emit:u}){const v=F,p=u,d=_(()=>{switch(v.stageTypeFilter){case"stage":return"Nur BÃ¼hnen";case"workshop":return"Nur Workshops";case"all":default:return"Alle Locations"}});return(f,l)=>(i(),c("button",{onClick:l[0]||(l[0]=$=>p("toggle"))},S(d.value),1))}}),De={class:"table-content"},we={class:"timeline"},Te={class:"timeline-column"},Se={class:"timeline-header"},ke={class:"stages"},Fe={class:"timeline-header"},He={key:0},Me={key:1},be={key:2},$e=A({__name:"ScheduleTableItem",props:{date:String,stageTypeFilter:{type:String,default:"stage"},nowLineRef:{type:Object,required:!1}},setup(F){const u=F,v=C(null),p=C(null);p.value=new Date("2025-07-25T15:50:00");const d=C(p.value??new Date),f=()=>{d.value=p.value??new Date};te(()=>{const n=setInterval(f,6e4);f(),se(()=>clearInterval(n)),l(u.date)&&(u.nowLineRef.value=v.value)});function l(n){if(!n)return!1;const t=new Date(n),s=new Date;return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}const{performances:$,acts:I,stages:h}=Q(),D=n=>ae(n,I),m=_(()=>$.value.filter(n=>{const t=new Date(n.start_time),s=new Date(u.date),o=t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate(),a=t.getHours()<b&&t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()+1;return t.getHours()<b&&t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()?!1:o||a}).sort((n,t)=>{const s=new Date(n.start_time)??new Date(0),o=new Date(t.start_time)??new Date(0);return s.getTime()-o.getTime()})),w=_(()=>h.value.filter(n=>{const t=u.stageTypeFilter==="all"||n.type===u.stageTypeFilter,s=m.value.some(o=>o.stageID===n.id);return t&&s})),e=_(()=>{const t=m.value.flatMap(a=>[new Date(a.start_time).getHours(),new Date(a.end_time).getHours()]).map(a=>a<b?a+24:a),s=Math.min(...t)-1,o=Math.max(...t)+1;return Array.from({length:o-s+1},(a,T)=>(s+T)%24)}),y=n=>{const t=new Date(n.start_time),s=new Date(n.end_time),o=e.value[0],a=e.value.length*60,T=(t.getHours()<o?t.getHours()+24:t.getHours())*60+t.getMinutes()-o*60,N=(s.getHours()<o?s.getHours()+24:s.getHours())*60+s.getMinutes()-o*60,L=T/a*100,B=(N-T)/a*100,j=1,U=e.value.length*60,G=j/U*100;return{top:`${L}%`,height:`calc(${B}% - ${G}%)`}},H=()=>{const n=e.value[0];return{height:`${((e.value[e.value.length-1]<n?e.value[e.value.length-1]+24:e.value[e.value.length-1])-n+1)*60}px`}},R=n=>{const t=e.value[0],s=e.value.length*60;return{top:((n<t?n+24:n)*60-t*60)/s*100+"%"}},W=n=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(n)?n:"default",z=_(()=>{if(!d.value||!u.date)return{display:"none"};const n=new Date(u.date),t=d.value,s=new Date(t);if(s.getHours()<b&&s.setDate(s.getDate()-1),!(s.getFullYear()===n.getFullYear()&&s.getMonth()===n.getMonth()&&s.getDate()===n.getDate()))return{display:"none"};const a=e.value[0],T=e.value[e.value.length-1]<a?e.value[e.value.length-1]+24:e.value[e.value.length-1],N=Array.from({length:T-a+1},(G,X)=>a+X);let L=t.getHours();if(L<b&&(L+=24),!N.includes(L))return{display:"none"};const B=N.length*60;return{top:`${(L*60+t.getMinutes()-a*60)/B*100}%`}});return(n,t)=>{const s=re("router-link");return i(),c("div",De,[g("div",we,[g("div",Te,[g("div",Se,S(n.$t("Time")),1),g("div",{class:"time-slots",style:M(H())},[(i(!0),c(E,null,x(e.value,o=>(i(),c("div",{key:o,class:"time-slot",style:M(R(o))},S(o%24)+":00 ",5))),128)),g("div",{class:"now-line",ref_key:"nowLine",ref:v,style:M(z.value)},null,4)],4)])]),g("div",ke,[(i(!0),c(E,null,x(w.value,o=>(i(),c("div",{key:o.id,class:"stage"},[g("div",Fe,S(o.name),1),g("div",{class:"events",style:M(H())},[g("div",{class:"now-line",style:M(z.value)},null,4),(i(!0),c(E,null,x(e.value,a=>(i(),c("div",{key:a,class:"time-slot",style:M(R(a))},null,4))),128)),(i(!0),c(E,null,x(m.value.filter(a=>a.stageID===o.id),a=>{var T;return i(),V(s,{key:a.id,to:"/event/"+(((T=a["id-name"])==null?void 0:T.trim())||a.id),class:ne(["event",W(a==null?void 0:a.type)]),style:M(y(a)),title:a.name||D(a.actsIDArr)||n.$t("Unknown")},{default:J(()=>[g("strong",null,[a.name?(i(),c("div",He,S(a.name),1)):a.actsIDArr.length?(i(),c("div",Me,S(D(a.actsIDArr)),1)):(i(),c("div",be,S(n.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),Ie=le($e,[["__scopeId","data-v-2690c001"]]),Le={class:"schedule-table scroll-head full-height"},Ce={class:"btn-header"},Ae={class:"timetable scroll-y-area"},Ee=A({__name:"ScheduleTable",setup(F){Y();const{scrollToDate:u}=ue(),{performances:v}=Q(),p=C(null),d=["stage","all"],f=C("stage");function l(){console.log("FlowBtnClick",p.value),p.value&&(p.value.scrollIntoView({behavior:"smooth",block:"center"}),p.value.classList.add("highlight"),setTimeout(()=>{var h;return(h=p.value)==null?void 0:h.classList.remove("highlight")},2e3))}const $=()=>{const h=d.indexOf(f.value);f.value=d[(h+1)%d.length]},I=_(()=>{const h=new Set;return v.value.forEach(D=>{const m=new Date(D.start_time),w=m.getHours();let e=new Date(m);w<b&&e.setDate(e.getDate()-1);const y=e.toLocaleDateString("sv-SE");h.add(y)}),Array.from(h).sort()});return _(()=>{const h=new Set(v.value.map(m=>new Date(m.start_time).toLocaleDateString("en-CA"))),D=new Set;return v.value.forEach(m=>{const w=new Date(m.start_time),e=w.getHours();if(e>=0&&e<b){const y=new Date(w);y.setDate(w.getDate()-1),D.add(y.toLocaleDateString("en-CA"))}}),Array.from(new Set([...h,...D])).sort()}),(h,D)=>(i(),c("div",Le,[g("div",Ce,[k(K,{targetView:"list",class:"btn left"}),k(_e,{class:"btn right",stageTypeFilter:f.value,onToggle:$},null,8,["stageTypeFilter"])]),k(ge,{class:"flow-btn",onClick:l},{default:J(()=>[oe(S(h.$t("now")),1)]),_:1}),g("div",Ae,[(i(!0),c(E,null,x(I.value,(m,w)=>(i(),c("div",{key:m,class:"day-table"},[k(ve,{date:m,index:w,sortedDateList:I.value,scrollToDate:ie(u)},null,8,["date","index","sortedDateList","scrollToDate"]),k(Ie,{date:m,stageTypeFilter:f.value},null,8,["date","stageTypeFilter"])]))),128))])]))}}),xe={class:"full-height"},Ne={class:"full-height"},Qe=A({__name:"ScheduleView",setup(F){const u=O();Y();const v=_(()=>u.query.view??"list");return(p,d)=>(i(),c("div",null,[q(g("div",xe,[k(fe,{class:"full-height"})],512),[[P,v.value==="list"]]),q(g("div",Ne,[k(Ee,{class:"full-height"})],512),[[P,v.value==="table"]])]))}});export{Qe as default};
