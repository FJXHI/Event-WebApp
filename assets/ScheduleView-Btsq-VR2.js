import{d as x,a as u,t as S,p as O,q as Q,o as c,c as _,r as A,s as Z,v as l,b as v,w as V,x as P,g as k,y as q,z as ee,A as Y,B as te,C as se,D as L,n as H,F as E,E as C,G as J,H as ae,J as ne,K as re,_ as le,L as oe,u as ie,M as ce}from"./index-B4V8xzw8.js";import{S as ue,F as ge,D as pe}from"./ScheduleListItem-DTRajD7x.js";import{S as ve,F as de}from"./SearchBar-BF0601o3.js";import{N as he}from"./NoEntries-BfvaeXMu.js";import{u as z}from"./useEventData-Cw96nZF2.js";import"./TagLabel-BsFDXJVr.js";const K=x({__name:"SwitchView",props:{targetView:{}},setup(F){const h=F,g=O(),f=Q(),p=()=>{g.replace({query:{...f.query,view:h.targetView}})};return(D,o)=>(c(),u("button",{onClick:p},S(D.$t("change-view")),1))}}),me={class:"full-height"},fe={class:"btn-header"},ye=x({__name:"ScheduleList",setup(F){const{performances:h}=z(),g=Q(),f=_(()=>g.query.search??"false"),p=_(()=>g.query.fav==="true"),D=A(!1),o=Z({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),b=r=>{l.value.searchQuery=r,l.value.stages=[],l.value.stageTypes=[],l.value.categories=[],l.value.actTypes=[],l.value.perforTypes=[],l.value.performanceTags=[],l.value.actIDs=[],l.value.performanceIDs=[]},$=r=>{l.value.stages=r.stages||[],l.value.stageTypes=r.stageTypes||[],l.value.categories=r.categories||[],l.value.actTypes=r.actTypes||[],l.value.perforTypes=r.perforTypes||[],l.value.performanceTags=r.performanceTags||[],l.value.searchQuery=r.searchQuery||"",l.value.actIDs=r.actIDs||[],l.value.performanceIDs=r.performanceIDs||[],o.stages=[...l.value.stages],o.stageTypes=[...l.value.stageTypes],o.categories=[...l.value.categories],o.actTypes=[...l.value.actTypes],o.perforTypes=[...l.value.perforTypes],o.performanceTags=[...l.value.performanceTags],o.searchQuery=l.value.searchQuery},y=_(()=>p.value?{...l.value,performanceIDs:T.value.map(r=>String(r.id))}:l.value),T=_(()=>{const r=JSON.parse(localStorage.getItem("event")||"[]");return!h.value||h.value.length===0?(console.warn("Performances data not available yet!"),[]):h.value.filter(d=>r.includes(d.id.toString()))}),m=_(()=>T.value.length>0),t=_(()=>{if(!h.value)return!1;let r=h.value;if(p.value){const d=T.value.map(M=>M.id.toString());r=r.filter(M=>d.includes(M.id.toString()))}return r.length>0});return(r,d)=>(c(),u("div",me,[v("div",null,[P(k(ve,{onApply:b},null,512),[[q,f.value==="true"]])]),v("div",fe,[D.value?(c(),V(de,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":o.stages,"initial-stage-types":o.stageTypes,"initial-categories":o.categories,"initial-act-types":o.actTypes,"initial-perfor-types":o.perforTypes,"initial-performance-tags":o.performanceTags,"initial-search-query":o.searchQuery,onApply:$,onClose:d[0]||(d[0]=M=>D.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):ee("",!0),k(K,{targetView:"table",class:"btn left"}),v("button",{onClick:d[1]||(d[1]=M=>D.value=!0),class:"btn right"},S(r.$t("open-filter")),1)]),t.value?(c(),V(ue,{key:0,filters:y.value,class:"ProgrammList"},null,8,["filters"])):(c(),V(he,{key:1,type:p.value&&!m.value?"favorites":"event"},null,8,["type"]))]))}}),_e=x({__name:"SwitchViewType",props:{stageTypeFilter:{}},emits:["toggle"],setup(F,{emit:h}){const g=F,f=h,p=_(()=>{switch(g.stageTypeFilter){case"stage":return"Nur BÃ¼hnen";case"workshop":return"Nur Workshops";case"all":default:return"Alle Locations"}});return(D,o)=>(c(),u("button",{onClick:o[0]||(o[0]=b=>f("toggle"))},S(p.value),1))}}),De={class:"table-content"},Te={class:"timeline"},we={class:"timeline-column"},Se={class:"timeline-header"},ke={class:"stages"},Fe={class:"timeline-header"},Me={key:0},He={key:1},be={key:2},$e=x({__name:"ScheduleTableItem",props:{date:String,stageTypeFilter:{type:String,default:"stage"}},setup(F,{expose:h}){const g=F,f=A(null);h({nowLine:f});const p=A(Y.value??new Date),D=()=>{p.value=Y.value??new Date};te(()=>{const n=setInterval(D,6e4);D(),se(()=>clearInterval(n))});const{performances:o,acts:b,stages:$}=z(),y=n=>ae(n,b),T=_(()=>o.value.filter(n=>{const s=new Date(n.start_time),a=new Date(g.date),i=s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate(),e=s.getHours()<L&&s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate()+1;return s.getHours()<L&&s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate()?!1:i||e}).sort((n,s)=>{const a=new Date(n.start_time)??new Date(0),i=new Date(s.start_time)??new Date(0);return a.getTime()-i.getTime()})),m=_(()=>$.value.filter(n=>{const s=g.stageTypeFilter==="all"||n.type===g.stageTypeFilter,a=T.value.some(i=>i.stageID===n.id);return s&&a})),t=_(()=>{const s=T.value.flatMap(e=>[new Date(e.start_time).getHours(),new Date(e.end_time).getHours()]).map(e=>e<L?e+24:e),a=Math.min(...s)-1,i=Math.max(...s)+1;return Array.from({length:i-a+1},(e,w)=>(a+w)%24)}),r=n=>{const s=new Date(n.start_time),a=new Date(n.end_time),i=t.value[0],e=t.value.length*60,w=(s.getHours()<i?s.getHours()+24:s.getHours())*60+s.getMinutes()-i*60,N=(a.getHours()<i?a.getHours()+24:a.getHours())*60+a.getMinutes()-i*60,I=w/e*100,B=(N-w)/e*100,U=1,j=t.value.length*60,G=U/j*100;return{top:`${I}%`,height:`calc(${B}% - ${G}%)`}},d=()=>{const n=t.value[0];return{height:`${((t.value[t.value.length-1]<n?t.value[t.value.length-1]+24:t.value[t.value.length-1])-n+1)*60}px`}},M=n=>{const s=t.value[0],a=t.value.length*60;return{top:((n<s?n+24:n)*60-s*60)/a*100+"%"}},W=n=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(n)?n:"default",R=_(()=>{if(!p.value||!g.date)return{display:"none"};const n=new Date(g.date),s=p.value,a=new Date(s);if(a.getHours()<L&&a.setDate(a.getDate()-1),!(a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate()))return{display:"none"};const e=t.value[0],w=t.value[t.value.length-1]<e?t.value[t.value.length-1]+24:t.value[t.value.length-1],N=Array.from({length:w-e+1},(G,X)=>e+X);let I=s.getHours();if(I<L&&(I+=24),!N.includes(I))return{display:"none"};const B=N.length*60;return{top:`${(I*60+s.getMinutes()-e*60)/B*100}%`}});return(n,s)=>{const a=re("router-link");return c(),u("div",De,[v("div",Te,[v("div",we,[v("div",Se,S(n.$t("Time")),1),v("div",{class:"time-slots",style:H(d())},[(c(!0),u(E,null,C(t.value,i=>(c(),u("div",{key:i,class:"time-slot",style:H(M(i))},S(i%24)+":00 ",5))),128)),v("div",{class:"now-line",ref_key:"nowLine",ref:f,style:H(R.value)},null,4)],4)])]),v("div",ke,[(c(!0),u(E,null,C(m.value,i=>(c(),u("div",{key:i.id,class:"stage"},[v("div",Fe,S(i.name),1),v("div",{class:"events",style:H(d())},[v("div",{class:"now-line",style:H(R.value)},null,4),(c(!0),u(E,null,C(t.value,e=>(c(),u("div",{key:e,class:"time-slot",style:H(M(e))},null,4))),128)),(c(!0),u(E,null,C(T.value.filter(e=>e.stageID===i.id),e=>{var w;return c(),V(a,{key:e.id,to:"/event/"+(((w=e["id-name"])==null?void 0:w.trim())||e.id),class:ne(["event",W(e==null?void 0:e.type)]),style:H(r(e)),title:e.name||y(e.actsIDArr)||n.$t("Unknown")},{default:J(()=>[v("strong",null,[e.name?(c(),u("div",Me,S(e.name),1)):e.actsIDArr.length?(c(),u("div",He,S(y(e.actsIDArr)),1)):(c(),u("div",be,S(n.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),Ie=le($e,[["__scopeId","data-v-bb4c916f"]]),Le={class:"schedule-table scroll-head full-height"},xe={class:"btn-header"},Ee={class:"timetable scroll-y-area"},Ce=x({__name:"ScheduleTable",setup(F){O();const{scrollToDate:h}=ce(),{performances:g}=z(),f=["stage","all"],p=A("stage"),D=A([]);function o(){const y=D.value,T=(Y.value??new Date).toLocaleDateString("sv-SE"),m=y.find(r=>{var d;return((d=r==null?void 0:r.$props)==null?void 0:d.date)===T}),t=m==null?void 0:m.nowLine;t?(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight"),setTimeout(()=>t==null?void 0:t.classList.remove("highlight"),2e3)):console.warn("nowLine not found")}const b=()=>{const y=f.indexOf(p.value);p.value=f[(y+1)%f.length]},$=_(()=>{const y=new Set;return g.value.forEach(T=>{const m=new Date(T.start_time),t=m.getHours();let r=new Date(m);t<L&&r.setDate(r.getDate()-1);const d=r.toLocaleDateString("sv-SE");y.add(d)}),Array.from(y).sort()});return(y,T)=>(c(),u("div",Le,[v("div",xe,[k(K,{targetView:"list",class:"btn left"}),k(_e,{class:"btn right",stageTypeFilter:p.value,onToggle:b},null,8,["stageTypeFilter"])]),k(ge,{class:"flow-btn",onClick:o},{default:J(()=>[oe(S(y.$t("now")),1)]),_:1}),v("div",Ee,[(c(!0),u(E,null,C($.value,(m,t)=>(c(),u("div",{key:m,class:"day-table"},[k(pe,{date:m,index:t,sortedDateList:$.value,scrollToDate:ie(h)},null,8,["date","index","sortedDateList","scrollToDate"]),k(Ie,{ref_for:!0,ref_key:"scheduleRef",ref:D,date:m,stageTypeFilter:p.value},null,8,["date","stageTypeFilter"])]))),128))])]))}}),Ae={class:"full-height"},Ne={class:"full-height"},Qe=x({__name:"ScheduleView",setup(F){const h=Q();O();const g=_(()=>h.query.view??"list");return(f,p)=>(c(),u("div",null,[P(v("div",Ae,[k(ye,{class:"full-height"})],512),[[q,g.value==="list"]]),P(v("div",Ne,[k(Ce,{class:"full-height"})],512),[[q,g.value==="table"]])]))}});export{Qe as default};
