import{d as b,a as u,t as S,p as q,q as L,o as l,c as d,r as G,s as U,v as n,b as g,w as A,x as F,g as w,y as x,z as J,A as y,B as M,n as k,F as I,C as $,D as K,E as W,G as j,H as X,_ as N}from"./index-wBXin9OV.js";import{S as Z,D as ee}from"./ScheduleListItem-C0JroQk_.js";import{S as te,F as se}from"./SearchBar-XVfaXiNu.js";import{N as ae}from"./NoEntries-CNu_u69D.js";import{u as V}from"./useEventData-KXQgSDwr.js";import"./TagLabel-B8kd2pEY.js";const B=b({__name:"SwitchView",props:{targetView:{}},setup(H){const v=H,m=q(),_=L(),h=()=>{m.replace({query:{..._.query,view:v.targetView}})};return(c,r)=>(l(),u("button",{onClick:h},S(c.$t("change-view")),1))}}),re={class:"full-height"},ne={class:"btn-header"},oe=b({__name:"ScheduleList",setup(H){const{performances:v}=V(),m=L(),_=d(()=>m.query.search??"false"),h=d(()=>m.query.fav==="true"),c=G(!1),r=U({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),p=e=>{n.value.searchQuery=e,n.value.stages=[],n.value.stageTypes=[],n.value.categories=[],n.value.actTypes=[],n.value.perforTypes=[],n.value.performanceTags=[],n.value.actIDs=[],n.value.performanceIDs=[]},o=e=>{n.value.stages=e.stages||[],n.value.stageTypes=e.stageTypes||[],n.value.categories=e.categories||[],n.value.actTypes=e.actTypes||[],n.value.perforTypes=e.perforTypes||[],n.value.performanceTags=e.performanceTags||[],n.value.searchQuery=e.searchQuery||"",n.value.actIDs=e.actIDs||[],n.value.performanceIDs=e.performanceIDs||[],r.stages=[...n.value.stages],r.stageTypes=[...n.value.stageTypes],r.categories=[...n.value.categories],r.actTypes=[...n.value.actTypes],r.perforTypes=[...n.value.perforTypes],r.performanceTags=[...n.value.performanceTags],r.searchQuery=n.value.searchQuery},D=d(()=>h.value?{...n.value,performanceIDs:f.value.map(e=>String(e.id))}:n.value),f=d(()=>{const e=JSON.parse(localStorage.getItem("event")||"[]");return!v.value||v.value.length===0?(console.warn("Performances data not available yet!"),[]):v.value.filter(t=>e.includes(t.id.toString()))}),E=d(()=>f.value.length>0),C=d(()=>{if(!v.value)return!1;let e=v.value;if(h.value){const t=f.value.map(a=>a.id.toString());e=e.filter(a=>t.includes(a.id.toString()))}return e.length>0});return(e,t)=>(l(),u("div",re,[g("div",null,[F(w(te,{onApply:p},null,512),[[x,_.value==="true"]])]),g("div",ne,[c.value?(l(),A(se,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":r.stages,"initial-stage-types":r.stageTypes,"initial-categories":r.categories,"initial-act-types":r.actTypes,"initial-perfor-types":r.perforTypes,"initial-performance-tags":r.performanceTags,"initial-search-query":r.searchQuery,onApply:o,onClose:t[0]||(t[0]=a=>c.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):J("",!0),w(B,{targetView:"table",class:"btn left"}),g("button",{onClick:t[1]||(t[1]=a=>c.value=!0),class:"btn right"},S(e.$t("open-filter")),1)]),C.value?(l(),A(Z,{key:0,filters:D.value,class:"ProgrammList"},null,8,["filters"])):(l(),A(ae,{key:1,type:h.value&&!E.value?"favorites":"event"},null,8,["type"]))]))}}),le={class:"table-content"},ie={class:"timeline"},ce={class:"timeline-column"},ue={class:"timeline-header"},ge={class:"stages"},ve={class:"timeline-header"},pe={key:0},de={key:1},me={key:2},he=b({__name:"ScheduleTableItem",props:{date:String},setup(H){const v=H,{performances:m,acts:_,stages:h}=V(),c=e=>W(e,_),r=d(()=>m.value.filter(e=>{const t=y(e.start_time),a=y(v.date),i=t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate(),s=t.getHours()<M&&t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()+1;return t.getHours()<M&&t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()?!1:i||s}).sort((e,t)=>{const a=y(e.start_time)??new Date(0),i=y(t.start_time)??new Date(0);return a.getTime()-i.getTime()})),p=d(()=>h.value.filter(e=>r.value.some(t=>t.stageID===e.id))),o=d(()=>{const t=r.value.flatMap(s=>[y(s.start_time).getHours(),y(s.end_time).getHours()]).map(s=>s<M?s+24:s),a=Math.min(...t)-1,i=Math.max(...t)+1;return Array.from({length:i-a+1},(s,T)=>(a+T)%24)}),D=e=>{const t=y(e.start_time),a=y(e.end_time),i=o.value[0],s=o.value.length*60,T=(t.getHours()<i?t.getHours()+24:t.getHours())*60+t.getMinutes()-i*60,P=(a.getHours()<i?a.getHours()+24:a.getHours())*60+a.getMinutes()-i*60,Q=T/s*100,z=(P-T)/s*100,Y=1,O=o.value.length*60,R=Y/O*100;return{top:`${Q}%`,height:`calc(${z}% - ${R}%)`}},f=()=>{const e=o.value[0];return{height:`${((o.value[o.value.length-1]<e?o.value[o.value.length-1]+24:o.value[o.value.length-1])-e+1)*60}px`}},E=e=>{const t=o.value[0],a=o.value.length*60;return{top:((e<t?e+24:e)*60-t*60)/a*100+"%"}},C=e=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(e)?e:"default";return(e,t)=>{const a=X("router-link");return l(),u("div",le,[g("div",ie,[g("div",ce,[g("div",ue,S(e.$t("Time")),1),g("div",{class:"time-slots",style:k(f())},[(l(!0),u(I,null,$(o.value,i=>(l(),u("div",{key:i,class:"time-slot",style:k(E(i))},S(i%24)+":00 ",5))),128))],4)])]),g("div",ge,[(l(!0),u(I,null,$(p.value,i=>(l(),u("div",{key:i.id,class:"stage"},[g("div",ve,S(i.name),1),g("div",{class:"events",style:k(f())},[(l(!0),u(I,null,$(o.value,s=>(l(),u("div",{key:s,class:"time-slot",style:k(E(s))},null,4))),128)),(l(!0),u(I,null,$(r.value.filter(s=>s.stageID===i.id),s=>{var T;return l(),A(a,{key:s.id,to:"/event/"+(((T=s["id-name"])==null?void 0:T.trim())||s.id),class:j(["event",C(s==null?void 0:s.type)]),style:k(D(s)),title:s.name||c(s.actsIDArr)||e.$t("Unknown")},{default:K(()=>[g("strong",null,[s.name?(l(),u("div",pe,S(s.name),1)):s.actsIDArr.length?(l(),u("div",de,S(c(s.actsIDArr)),1)):(l(),u("div",me,S(e.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),fe=N(he,[["__scopeId","data-v-4e456dcd"]]),ye={class:"schedule-table scroll-head full-height"},_e={class:"btn-header"},De={class:"timetable scroll-y-area"},Te=b({__name:"ScheduleTable",setup(H){const v=q();function m(c){v.replace({hash:`#${c}`,query:{...v.currentRoute.value.query}});const r=document.getElementById(c);r&&r.scrollIntoView({behavior:"smooth"})}const{performances:_}=V(),h=d(()=>{const c=new Set;return _.value.forEach(r=>{const p=y(r.start_time),o=p.getHours();let D=new Date(p);o<M&&D.setDate(D.getDate()-1);const f=D.toLocaleDateString("sv-SE");c.add(f)}),Array.from(c).sort()});return d(()=>{const c=new Set(_.value.map(p=>y(p.start_time).toLocaleDateString("en-CA"))),r=new Set;return _.value.forEach(p=>{const o=y(p.start_time),D=o.getHours();if(D>=0&&D<M){const f=new Date(o);f.setDate(o.getDate()-1),r.add(f.toLocaleDateString("en-CA"))}}),Array.from(new Set([...c,...r])).sort()}),(c,r)=>(l(),u("div",ye,[g("div",_e,[w(B,{targetView:"list",class:"btn full"})]),g("div",De,[(l(!0),u(I,null,$(h.value,(p,o)=>(l(),u("div",{key:p,class:"day-table"},[w(ee,{date:p,index:o,sortedDateList:h.value,scrollToDate:m},null,8,["date","index","sortedDateList"]),w(fe,{date:p},null,8,["date"])]))),128))])]))}}),Se=N(Te,[["__scopeId","data-v-5d36a960"]]),we={class:"full-height"},He={class:"full-height"},Ae=b({__name:"ScheduleView",setup(H){const v=L();q();const m=d(()=>v.query.view??"list");return(_,h)=>(l(),u("div",null,[F(g("div",we,[w(oe,{class:"full-height"})],512),[[x,m.value==="list"]]),F(g("div",He,[w(Se,{class:"full-height"})],512),[[x,m.value==="table"]])]))}});export{Ae as default};
