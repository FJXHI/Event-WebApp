import{d as M,a as l,t as T,p as V,q as L,o,c as D,r as U,s as J,v as s,b as v,g as $,w as E,x as q,y as B,z as K,A as y,B as A,n as I,F as H,C,D as W,E as j,G as X,H as Y,_ as P,u as Z,f as ee}from"./index-BdlLSpyO.js";import{S as te}from"./ScheduleListItem-_PS3nufG.js";import{S as se,F as ae}from"./SearchBar-BfzMeHYY.js";import{u as x}from"./useEventData-DS76df0J.js";import"./TagLabel-3Kw3Vu_T.js";const F=M({__name:"SwitchView",props:{targetView:{}},setup(b){const d=b,m=V(),_=L(),h=()=>{m.replace({query:{..._.query,view:d.targetView}})};return(p,a)=>(o(),l("button",{onClick:h},T(p.$t("change-view")),1))}}),re={class:"btn-header"},ne=M({__name:"ScheduleList",setup(b){const{performances:d}=x(),m=L(),_=D(()=>m.query.search??"false"),h=D(()=>m.query.fav==="true"),p=U(!1),a=J({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),g=i=>{s.value.searchQuery=i,s.value.stages=[],s.value.stageTypes=[],s.value.categories=[],s.value.actTypes=[],s.value.perforTypes=[],s.value.performanceTags=[],s.value.actIDs=[],s.value.performanceIDs=[]},r=i=>{s.value.stages=i.stages||[],s.value.stageTypes=i.stageTypes||[],s.value.categories=i.categories||[],s.value.actTypes=i.actTypes||[],s.value.perforTypes=i.perforTypes||[],s.value.performanceTags=i.performanceTags||[],s.value.searchQuery=i.searchQuery||"",s.value.actIDs=i.actIDs||[],s.value.performanceIDs=i.performanceIDs||[],a.stages=[...s.value.stages],a.stageTypes=[...s.value.stageTypes],a.categories=[...s.value.categories],a.actTypes=[...s.value.actTypes],a.perforTypes=[...s.value.perforTypes],a.performanceTags=[...s.value.performanceTags],a.searchQuery=s.value.searchQuery},S=D(()=>h.value?{...s.value,performanceIDs:k.value.map(i=>String(i.id))}:s.value),k=D(()=>{const i=JSON.parse(localStorage.getItem("event")||"[]");return!d.value||d.value.length===0?(console.warn("Performances data not available yet!"),[]):d.value.filter(w=>i.includes(w.id.toString()))});return(i,w)=>(o(),l("div",null,[v("div",null,[E($(se,{onApply:g},null,512),[[q,_.value==="true"]])]),v("div",re,[p.value?(o(),B(ae,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":a.stages,"initial-stage-types":a.stageTypes,"initial-categories":a.categories,"initial-act-types":a.actTypes,"initial-perfor-types":a.perforTypes,"initial-performance-tags":a.performanceTags,"initial-search-query":a.searchQuery,onApply:r,onClose:w[0]||(w[0]=t=>p.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):K("",!0),$(F,{targetView:"table",class:"btn left"}),v("button",{onClick:w[1]||(w[1]=t=>p.value=!0),class:"btn right"},T(i.$t("open-filter")),1)]),$(te,{filters:S.value,class:"ProgrammList"},null,8,["filters"])]))}}),oe={class:"table-content"},le={class:"timeline"},ie={class:"timeline-column"},ce={class:"timeline-header"},ue={class:"stages"},ve={class:"timeline-header"},pe={key:0},de={key:1},me={key:2},ge=M({__name:"ScheduleTableItem",props:{date:String},setup(b){const d=b,{performances:m,acts:_,stages:h}=x(),p=t=>X(t,_),a=D(()=>m.value.filter(t=>{const n=y(t.start_time),u=y(d.date),c=n.getHours()<A&&n.getDate()===u.getDate()+1,f=n.getDate()===u.getDate()||c;return n.getHours()<A&&n.getDate()===u.getDate()?!1:f}).sort((t,n)=>{const u=y(t.start_time)??new Date(0),c=y(n.start_time)??new Date(0);return u.getTime()-c.getTime()})),g=D(()=>h.value.filter(t=>a.value.some(n=>n.stageID===t.id))),r=D(()=>{const n=a.value.flatMap(e=>[y(e.start_time).getHours(),y(e.end_time).getHours()]).map(e=>e<A?e+24:e),u=Math.min(...n)-1,c=Math.max(...n)+1;return Array.from({length:c-u+1},(e,f)=>(u+f)%24)}),S=t=>{const n=y(t.start_time),u=y(t.end_time),c=r.value[0],e=r.value.length*60,f=(n.getHours()<c?n.getHours()+24:n.getHours())*60+n.getMinutes()-c*60,N=(u.getHours()<c?u.getHours()+24:u.getHours())*60+u.getMinutes()-c*60,Q=f/e*100,z=(N-f)/e*100,O=1,R=r.value.length*60,G=O/R*100;return{top:`${Q}%`,height:`calc(${z}% - ${G}%)`}},k=()=>{const t=r.value[0];return{height:`${((r.value[r.value.length-1]<t?r.value[r.value.length-1]+24:r.value[r.value.length-1])-t+1)*60}px`}},i=t=>{const n=r.value[0],u=r.value.length*60;return{top:((t<n?t+24:t)*60-n*60)/u*100+"%"}},w=t=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(t)?t:"default";return(t,n)=>{const u=Y("router-link");return o(),l("div",oe,[v("div",le,[v("div",ie,[v("div",ce,T(t.$t("Time")),1),v("div",{class:"time-slots",style:I(k())},[(o(!0),l(H,null,C(r.value,c=>(o(),l("div",{key:c,class:"time-slot",style:I(i(c))},T(c%24)+":00 ",5))),128))],4)])]),v("div",ue,[(o(!0),l(H,null,C(g.value,c=>(o(),l("div",{key:c.id,class:"stage"},[v("div",ve,T(c.name),1),v("div",{class:"events",style:I(k())},[(o(!0),l(H,null,C(r.value,e=>(o(),l("div",{key:e,class:"time-slot",style:I(i(e))},null,4))),128)),(o(!0),l(H,null,C(a.value.filter(e=>e.stageID===c.id),e=>{var f;return o(),B(u,{key:e.id,to:"/event/"+(((f=e["id-name"])==null?void 0:f.trim())||e.id),class:j(["event",w(e==null?void 0:e.type)]),style:I(S(e)),title:e.name||p(e.actsIDArr)||t.$t("Unknown")},{default:W(()=>[v("strong",null,[e.name?(o(),l("div",pe,T(e.name),1)):e.actsIDArr.length?(o(),l("div",de,T(p(e.actsIDArr)),1)):(o(),l("div",me,T(t.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),he=P(ge,[["__scopeId","data-v-b85be1ad"]]),ye={class:"schedule-table"},_e={class:"btn-header"},fe={class:"timetable"},Te={class:"group-head"},De={class:"date-nav-container"},Se=["onClick"],we={key:1,class:"nav-arrow nav-left"},ke=["id"],$e=["onClick"],be={key:3,class:"nav-arrow nav-right"},Ie=M({__name:"ScheduleTable",setup(b){const d=V();function m(p){d.replace({hash:`#${p}`,query:{...d.currentRoute.value.query}});const a=document.getElementById(p);a&&a.scrollIntoView({behavior:"smooth"})}const{performances:_}=x(),h=D(()=>{const p=new Set(_.value.map(g=>y(g.start_time).toLocaleDateString("en-CA"))),a=new Set;return _.value.forEach(g=>{const r=y(g.start_time),S=r.getHours();if(S>=0&&S<A){const k=new Date(r);k.setDate(r.getDate()-1),a.add(k.toLocaleDateString("en-CA"))}}),Array.from(new Set([...p,...a])).sort()});return(p,a)=>(o(),l("div",ye,[v("div",_e,[$(F,{targetView:"list",class:"btn full"})]),v("div",fe,[(o(!0),l(H,null,C(h.value,(g,r)=>(o(),l("div",{key:g,class:"day-table"},[v("div",Te,[v("div",De,[r>0?(o(),l("button",{key:0,class:"nav-arrow nav-left",onClick:S=>m(h.value[r-1])}," < ",8,Se)):(o(),l("div",we)),v("h2",{class:"head-date",id:g},T(Z(ee)(g,"Date Long")),9,ke),r<h.value.length-1?(o(),l("button",{key:2,class:"nav-arrow nav-right",onClick:S=>m(h.value[r+1])}," > ",8,$e)):(o(),l("div",be))])]),$(he,{date:g},null,8,["date"])]))),128))])]))}}),He=P(Ie,[["__scopeId","data-v-7093c658"]]),Ve=M({__name:"ScheduleView",setup(b){const d=L();V();const m=D(()=>d.query.view??"list");return(_,h)=>(o(),l("div",null,[E(v("div",null,[$(ne)],512),[[q,m.value==="list"]]),E(v("div",null,[$(He)],512),[[q,m.value==="table"]])]))}});export{Ve as default};
