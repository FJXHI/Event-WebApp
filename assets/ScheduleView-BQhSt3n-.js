import{d as b,a as c,t as T,p as L,q as V,o as l,c as m,r as G,s as J,v as n,b as u,w as A,x as F,g as S,y as x,z as R,A as f,B as I,n as k,F as M,C as $,D as U,E as K,G as W,H as j,_ as X,u as Z,J as ee}from"./index-Cx15TtZS.js";import{S as te,D as se}from"./ScheduleListItem-CXSjjlri.js";import{S as ae,F as re}from"./SearchBar-sLHA-UAf.js";import{N as ne}from"./NoEntries-BPyCrKtn.js";import{u as q}from"./useEventData-C6iDhGDs.js";import"./TagLabel-DDr9kjT6.js";const N=b({__name:"SwitchView",props:{targetView:{}},setup(w){const p=w,d=L(),y=V(),g=()=>{d.replace({query:{...y.query,view:p.targetView}})};return(v,a)=>(l(),c("button",{onClick:g},T(v.$t("change-view")),1))}}),oe={class:"full-height"},le={class:"btn-header"},ie=b({__name:"ScheduleList",setup(w){const{performances:p}=q(),d=V(),y=m(()=>d.query.search??"false"),g=m(()=>d.query.fav==="true"),v=G(!1),a=J({stages:[],stageTypes:[],categories:[],actTypes:[],perforTypes:[],performanceTags:[],searchQuery:""}),h=e=>{n.value.searchQuery=e,n.value.stages=[],n.value.stageTypes=[],n.value.categories=[],n.value.actTypes=[],n.value.perforTypes=[],n.value.performanceTags=[],n.value.actIDs=[],n.value.performanceIDs=[]},o=e=>{n.value.stages=e.stages||[],n.value.stageTypes=e.stageTypes||[],n.value.categories=e.categories||[],n.value.actTypes=e.actTypes||[],n.value.perforTypes=e.perforTypes||[],n.value.performanceTags=e.performanceTags||[],n.value.searchQuery=e.searchQuery||"",n.value.actIDs=e.actIDs||[],n.value.performanceIDs=e.performanceIDs||[],a.stages=[...n.value.stages],a.stageTypes=[...n.value.stageTypes],a.categories=[...n.value.categories],a.actTypes=[...n.value.actTypes],a.perforTypes=[...n.value.perforTypes],a.performanceTags=[...n.value.performanceTags],a.searchQuery=n.value.searchQuery},_=m(()=>g.value?{...n.value,performanceIDs:H.value.map(e=>String(e.id))}:n.value),H=m(()=>{const e=JSON.parse(localStorage.getItem("event")||"[]");return!p.value||p.value.length===0?(console.warn("Performances data not available yet!"),[]):p.value.filter(t=>e.includes(t.id.toString()))}),E=m(()=>H.value.length>0),C=m(()=>{if(!p.value)return!1;let e=p.value;if(g.value){const t=H.value.map(r=>r.id.toString());e=e.filter(r=>t.includes(r.id.toString()))}return e.length>0});return(e,t)=>(l(),c("div",oe,[u("div",null,[F(S(ae,{onApply:h},null,512),[[x,y.value==="true"]])]),u("div",le,[v.value?(l(),A(re,{key:0,showStageFilter:!0,showStageTypeFilter:!0,showCategoryFilter:!0,showActTypeFilter:!0,showPerforTypeFilter:!0,showPerformanceTagFilter:!0,"initial-stages":a.stages,"initial-stage-types":a.stageTypes,"initial-categories":a.categories,"initial-act-types":a.actTypes,"initial-perfor-types":a.perforTypes,"initial-performance-tags":a.performanceTags,"initial-search-query":a.searchQuery,onApply:o,onClose:t[0]||(t[0]=r=>v.value=!1)},null,8,["initial-stages","initial-stage-types","initial-categories","initial-act-types","initial-perfor-types","initial-performance-tags","initial-search-query"])):R("",!0),S(N,{targetView:"table",class:"btn left"}),u("button",{onClick:t[1]||(t[1]=r=>v.value=!0),class:"btn right"},T(e.$t("open-filter")),1)]),C.value?(l(),A(te,{key:0,filters:_.value,class:"ProgrammList"},null,8,["filters"])):(l(),A(ne,{key:1,type:g.value&&!E.value?"favorites":"event"},null,8,["type"]))]))}}),ce={class:"table-content"},ue={class:"timeline"},ge={class:"timeline-column"},ve={class:"timeline-header"},pe={class:"stages"},de={class:"timeline-header"},me={key:0},he={key:1},fe={key:2},ye=b({__name:"ScheduleTableItem",props:{date:String},setup(w){const p=w,{performances:d,acts:y,stages:g}=q(),v=e=>K(e,y),a=m(()=>d.value.filter(e=>{const t=f(e.start_time),r=f(p.date),i=t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate(),s=t.getHours()<I&&t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()+1;return t.getHours()<I&&t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()?!1:i||s}).sort((e,t)=>{const r=f(e.start_time)??new Date(0),i=f(t.start_time)??new Date(0);return r.getTime()-i.getTime()})),h=m(()=>g.value.filter(e=>a.value.some(t=>t.stageID===e.id))),o=m(()=>{const t=a.value.flatMap(s=>[f(s.start_time).getHours(),f(s.end_time).getHours()]).map(s=>s<I?s+24:s),r=Math.min(...t)-1,i=Math.max(...t)+1;return Array.from({length:i-r+1},(s,D)=>(r+D)%24)}),_=e=>{const t=f(e.start_time),r=f(e.end_time),i=o.value[0],s=o.value.length*60,D=(t.getHours()<i?t.getHours()+24:t.getHours())*60+t.getMinutes()-i*60,P=(r.getHours()<i?r.getHours()+24:r.getHours())*60+r.getMinutes()-i*60,B=D/s*100,Q=(P-D)/s*100,z=1,Y=o.value.length*60,O=z/Y*100;return{top:`${B}%`,height:`calc(${Q}% - ${O}%)`}},H=()=>{const e=o.value[0];return{height:`${((o.value[o.value.length-1]<e?o.value[o.value.length-1]+24:o.value[o.value.length-1])-e+1)*60}px`}},E=e=>{const t=o.value[0],r=o.value.length*60;return{top:((e<t?e+24:e)*60-t*60)/r*100+"%"}},C=e=>["concert","spezial","workshop","Musik","Kunst","Gesellschaft","Sport","Wirtschaft"].includes(e)?e:"default";return(e,t)=>{const r=j("router-link");return l(),c("div",ce,[u("div",ue,[u("div",ge,[u("div",ve,T(e.$t("Time")),1),u("div",{class:"time-slots",style:k(H())},[(l(!0),c(M,null,$(o.value,i=>(l(),c("div",{key:i,class:"time-slot",style:k(E(i))},T(i%24)+":00 ",5))),128))],4)])]),u("div",pe,[(l(!0),c(M,null,$(h.value,i=>(l(),c("div",{key:i.id,class:"stage"},[u("div",de,T(i.name),1),u("div",{class:"events",style:k(H())},[(l(!0),c(M,null,$(o.value,s=>(l(),c("div",{key:s,class:"time-slot",style:k(E(s))},null,4))),128)),(l(!0),c(M,null,$(a.value.filter(s=>s.stageID===i.id),s=>{var D;return l(),A(r,{key:s.id,to:"/event/"+(((D=s["id-name"])==null?void 0:D.trim())||s.id),class:W(["event",C(s==null?void 0:s.type)]),style:k(_(s)),title:s.name||v(s.actsIDArr)||e.$t("Unknown")},{default:U(()=>[u("strong",null,[s.name?(l(),c("div",me,T(s.name),1)):s.actsIDArr.length?(l(),c("div",he,T(v(s.actsIDArr)),1)):(l(),c("div",fe,T(e.$t("Unknown")),1))])]),_:2},1032,["to","class","style","title"])}),128))],4)]))),128))])])}}}),_e=X(ye,[["__scopeId","data-v-4e456dcd"]]),De={class:"schedule-table scroll-head full-height"},Te={class:"btn-header"},Se={class:"timetable scroll-y-area"},we=b({__name:"ScheduleTable",setup(w){L();const{scrollToDate:p}=ee(),{performances:d}=q(),y=m(()=>{const g=new Set;return d.value.forEach(v=>{const a=f(v.start_time),h=a.getHours();let o=new Date(a);h<I&&o.setDate(o.getDate()-1);const _=o.toLocaleDateString("sv-SE");g.add(_)}),Array.from(g).sort()});return m(()=>{const g=new Set(d.value.map(a=>f(a.start_time).toLocaleDateString("en-CA"))),v=new Set;return d.value.forEach(a=>{const h=f(a.start_time),o=h.getHours();if(o>=0&&o<I){const _=new Date(h);_.setDate(h.getDate()-1),v.add(_.toLocaleDateString("en-CA"))}}),Array.from(new Set([...g,...v])).sort()}),(g,v)=>(l(),c("div",De,[u("div",Te,[S(N,{targetView:"list",class:"btn full"})]),u("div",Se,[(l(!0),c(M,null,$(y.value,(a,h)=>(l(),c("div",{key:a,class:"day-table"},[S(se,{date:a,index:h,sortedDateList:y.value,scrollToDate:Z(p)},null,8,["date","index","sortedDateList","scrollToDate"]),S(_e,{date:a},null,8,["date"])]))),128))])]))}}),He={class:"full-height"},ke={class:"full-height"},Ce=b({__name:"ScheduleView",setup(w){const p=V();L();const d=m(()=>p.query.view??"list");return(y,g)=>(l(),c("div",null,[F(u("div",He,[S(ie,{class:"full-height"})],512),[[x,d.value==="list"]]),F(u("div",ke,[S(we,{class:"full-height"})],512),[[x,d.value==="table"]])]))}});export{Ce as default};
